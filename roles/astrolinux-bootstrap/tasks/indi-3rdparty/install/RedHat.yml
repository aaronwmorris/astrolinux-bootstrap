---

- name: Install distribution-gpg-keys
  package:
    name: distribution-gpg-keys
    state: present
  become: yes


- name: Create rpmfusion free gpg key tempfile
  tempfile:
    state: file
  register: rpmfusion_free_gpg_tempfile


- name: Create rpmfusion nonfree gpg key tempfile
  tempfile:
    state: file
  register: rpmfusion_nonfree_gpg_tempfile


- name: Copy rpmfusion free gpg key (Fedora)
  copy:
    src: gpg/RPM-GPG-KEY-rpmfusion-free-fedora-{{ ansible_facts['distribution_major_version'] }}
    dest: "{{ rpmfusion_free_gpg_tempfile.path }}"
  when:
    - ansible_facts['distribution'] == 'Fedora'
    - ansible_facts['distribution_major_version'] in ['32', '31', '30']


- name: Copy rpmfusion nonfree gpg key (Fedora)
  copy:
    src: gpg/RPM-GPG-KEY-rpmfusion-nonfree-fedora-{{ ansible_facts['distribution_major_version'] }}
    dest: "{{ rpmfusion_nonfree_gpg_tempfile.path }}"
  when:
    - ansible_facts['distribution'] == 'Fedora'
    - ansible_facts['distribution_major_version'] in ['32', '31', '30']


#- name: Copy rpmfusion free gpg key (CentOS)
#  copy:
#    src: gpg/RPM-GPG-KEY-rpmfusion-free-el-{{ ansible_facts['distribution_major_version'] }}
#    dest: "{{ rpmfusion_free_gpg_tempfile.path }}"
#  when:
#    - ansible_facts['distribution'] == 'CentOS'
#    - ansible_facts['distribution_major_version'] in ['8']


#- name: Copy rpmfusion nonfree gpg key (CentOS)
#  copy:
#    src: gpg/RPM-GPG-KEY-rpmfusion-nonfree-el-{{ ansible_facts['distribution_major_version'] }}
#    dest: "{{ rpmfusion_nonfree_gpg_tempfile.path }}"
#  when:
#    - ansible_facts['distribution'] == 'CentOS'
#    - ansible_facts['distribution_major_version'] in ['8']


- name: Import rpmfusion free gpg key (Fedora)
  rpm_key:
    state: present
    key: "{{ rpmfusion_free_gpg_tempfile.path }}"
  become: yes
  when:
    - ansible_facts['distribution'] == 'Fedora'
    - ansible_facts['distribution_major_version'] in ['30', '31', '32']


- name: Import rpmfusion nonfree gpg key (Fedora)
  rpm_key:
    state: present
    key: "{{ rpmfusion_nonfree_gpg_tempfile.path }}"
  become: yes
  when:
    - ansible_facts['distribution'] == 'Fedora'
    - ansible_facts['distribution_major_version'] in ['30', '31', '32']


#- name: Import rpmfusion free gpg key (CentOS)
#  rpm_key:
#    state: present
#    key: "{{ rpmfusion_free_gpg_tempfile.path }}"
#  become: yes
#  when:
#    - ansible_facts['distribution'] == 'CentOS'
#    - ansible_facts['distribution_major_version'] in ['8']


#- name: Import rpmfusion nonfree gpg key (CentOS)
#  rpm_key:
#    state: present
#    key: "{{ rpmfusion_nonfree_gpg_tempfile.path }}"
#  become: yes
#  when:
#    - ansible_facts['distribution'] == 'CentOS'
#    - ansible_facts['distribution_major_version'] in ['8']


- name: Enable the RPM Fusion repository (Fedora)
  dnf:
    name: "https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ ansible_facts['distribution_major_version'] }}.noarch.rpm"
    state: present
  become: yes
  when:
    - ansible_facts['distribution'] == 'Fedora'


#- name: Enable the RPM Fusion repository (CentOS)
#  dnf:
#    name: "https://mirrors.rpmfusion.org/free/el/rpmfusion-free-release-{{ ansible_facts['distribution_major_version'] }}.noarch.rpm"
#    state: present
#  become: yes
#  when:
#    - ansible_facts['distribution'] == 'CentOS'


- name: Install indi-3rdparty development packages
  package:
    name: "{{ indi_3rdparty_packages }}"
    state: present
    enablerepo: PowerTools
  become: yes
