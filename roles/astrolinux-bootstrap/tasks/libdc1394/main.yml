---

- include: "libdc1394/install/main.yml"


- set_fact:
    #libdc1394_src: "{{ projects_folder }}/src/libdc1394"
    libdc1394_build: "{{ projects_folder }}/build/libdc1394"
  tags:
    - always


- debug:
    msg:
      #- "libdc1394 src folder: {{ libdc1394_src }}"
      - "libdc1394 build folder: {{ libdc1394_build }}"


- name: Remove existing libdc1394 build folder
  file:
    path: "{{ libdc1394_build }}"
    state: absent


- name: Create libdc1394 build folder
  file:
    path: "{{ libdc1394_build }}"
    state: directory


- debug:
    msg:
      - "libdc1394 git repo: {{ libdc1394_git_repo }}"
      - "libdc1394 git tag: {{ libdc1394_git_version }}"


- name: Git checkout of libdc1394
  git:
    repo: "{{ libdc1394_git_repo }}"
    dest: "{{ libdc1394_build }}"
    depth: 1
    version: "{{ libdc1394_git_version }}"
    #force: yes
 

- name: Setup libdc1394 build
  command:
    cmd: "autoreconf -i -s"
    chdir: "{{ libdc1394_build }}"


- name: Configure libdc1394 build
  command:
    cmd: "./configure --prefix={{ install_prefix }}"
    chdir: "{{ libdc1394_build }}"


- name: Build libdc1394
  command:
    cmd: "make -j {{ parallel_processes }}"
    chdir: "{{ libdc1394_build }}"


- name: Install libdc1394
  command:
    cmd: "make install"
    chdir: "{{ libdc1394_build }}"
  become: yes


- name: Cleanup libdc1394 build folder
  file:
    path: "{{ libdc1394_build }}"
    state: absent
  tags:
    - cleanup


